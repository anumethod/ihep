exports.id=75,exports.ids=[75],exports.modules={47990:()=>{},80736:(a,b,c)=>{"use strict";c.r(b),c.d(b,{DatabaseStorage:()=>l,storage:()=>m});var d=c(91673),e=c(9608),f=c(77466),g=c(81503);if(e.Vz.webSocketConstructor=g.Ay,!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set. Did you forget to provision a database?");let h=new e.bC({connectionString:process.env.DATABASE_URL,max:10,idleTimeoutMillis:3e4,connectionTimeoutMillis:1e4});h.on("error",a=>{console.error("Unexpected error on idle client",a)});let i=(0,f.fd)(h,{schema:d});var j=c(48689),k=c(71559);class l{async getUser(a){let[b]=await i.select().from(d.users).where((0,j.eq)(d.users.id,a));return b}async getUserByUsername(a){let[b]=await i.select().from(d.users).where((0,j.eq)(d.users.username,a));return b}async getUserByEmail(a){let[b]=await i.select().from(d.users).where((0,j.eq)(d.users.email,a));return b}async createUser(a){let[b]=await i.insert(d.users).values(a).returning();return b}async updateUser(a,b){let[c]=await i.update(d.users).set(b).where((0,j.eq)(d.users.id,a)).returning();return c}async getResource(a){let[b]=await i.select().from(d.resources).where((0,j.eq)(d.resources.id,a));return b}async getResources(a){let b=i.select().from(d.resources);if(a){if(a.categories&&a.categories.length>0&&(b=b.where((0,j.RV)(d.resources.category,a.categories))),a.search){let c=`%${a.search}%`;b=b.where((0,j.or)((0,j.mj)(d.resources.name,c),(0,j.mj)(d.resources.description,c),(0,j.mj)(d.resources.category,c)))}let c=a.page||1,e=a.limit||10;b=b.limit(e).offset((c-1)*e)}return await b}async createResource(a){let[b]=await i.insert(d.resources).values(a).returning();return b}async updateResource(a,b){let[c]=await i.update(d.resources).set(b).where((0,j.eq)(d.resources.id,a)).returning();return c}async deleteResource(a){return(await i.delete(d.resources).where((0,j.eq)(d.resources.id,a)).returning({id:d.resources.id})).length>0}async getEvent(a){let[b]=await i.select().from(d.events).where((0,j.eq)(d.events.id,a));return b}async getEvents(a){let b=i.select().from(d.events);if(a){if(a.startDate&&(b=b.where((0,j.RO)(d.events.startTime,a.startDate))),a.endDate&&(b=b.where((0,j.wJ)(d.events.endTime,a.endDate))),a.category&&(b=b.where((0,j.eq)(d.events.category,a.category))),void 0!==a.isVirtual&&(b=b.where((0,j.eq)(d.events.isVirtual,a.isVirtual))),a.search){let c=`%${a.search}%`;b=b.where((0,j.or)((0,j.mj)(d.events.title,c),(0,j.mj)(d.events.description,c)))}let c=a.page||1,e=a.limit||10;b=b.limit(e).offset((c-1)*e)}return b=b.orderBy((0,k.Y)(d.events.startTime)),await b}async createEvent(a){let[b]=await i.insert(d.events).values(a).returning();return b}async updateEvent(a,b){let[c]=await i.update(d.events).set(b).where((0,j.eq)(d.events.id,a)).returning();return c}async deleteEvent(a){return(await i.delete(d.events).where((0,j.eq)(d.events.id,a)).returning({id:d.events.id})).length>0}async registerForEvent(a,b){let c=await this.getEvent(a);if(!c)return!1;let d=c.registeredUsers||[];return!!d.includes(b)||(d.push(b),!!await this.updateEvent(a,{registeredUsers:d}))}async unregisterFromEvent(a,b){let c=await this.getEvent(a);if(!c||!c.registeredUsers)return!1;let d=c.registeredUsers.filter(a=>a!==b);return!!await this.updateEvent(a,{registeredUsers:d})}async getCommunityGroup(a){let[b]=await i.select().from(d.communityGroups).where((0,j.eq)(d.communityGroups.id,a));return b}async getCommunityGroups(a){let b=i.select().from(d.communityGroups);if(a){if(void 0!==a.isPublic&&(b=b.where((0,j.eq)(d.communityGroups.isPublic,a.isPublic))),a.search){let c=`%${a.search}%`;b=b.where((0,j.or)((0,j.mj)(d.communityGroups.name,c),(0,j.mj)(d.communityGroups.description,c)))}let c=a.page||1,e=a.limit||10;b=b.limit(e).offset((c-1)*e)}return b=b.orderBy((0,k.i)(d.communityGroups.lastActive)),await b}async createCommunityGroup(a){let b=new Date,c={...a,createdAt:b,lastActive:b,memberCount:1,members:[1]},[e]=await i.insert(d.communityGroups).values(c).returning();return e}async updateCommunityGroup(a,b){let[c]=await i.update(d.communityGroups).set(b).where((0,j.eq)(d.communityGroups.id,a)).returning();return c}async deleteCommunityGroup(a){return(await i.delete(d.communityGroups).where((0,j.eq)(d.communityGroups.id,a)).returning({id:d.communityGroups.id})).length>0}async joinCommunityGroup(a,b){let c=await this.getCommunityGroup(a);if(!c)return!1;let d=c.members||[];if(!d.includes(b)){d.push(b);let e=(c.memberCount||0)+1;return!!await this.updateCommunityGroup(a,{members:d,memberCount:e,lastActive:new Date})}return!0}async leaveCommunityGroup(a,b){let c=await this.getCommunityGroup(a);if(!c||!c.members)return!1;let d=c.members.filter(a=>a!==b),e=Math.max(0,(c.memberCount||1)-1);return!!await this.updateCommunityGroup(a,{members:d,memberCount:e,lastActive:new Date})}async getDiscussion(a){let[b]=await i.select().from(d.discussions).where((0,j.eq)(d.discussions.id,a));return b}async getDiscussions(a){let b=i.select().from(d.discussions);if(a){if(void 0!==a.groupId&&(b=b.where((0,j.eq)(d.discussions.groupId,a.groupId))),void 0!==a.authorId&&(b=b.where((0,j.eq)(d.discussions.authorId,a.authorId))),a.search){let c=`%${a.search}%`;b=b.where((0,j.or)((0,j.mj)(d.discussions.title,c),(0,j.mj)(d.discussions.content,c)))}let c=a.page||1,e=a.limit||10;b=b.limit(e).offset((c-1)*e)}return b=b.orderBy((0,k.i)(d.discussions.createdAt)),await b}async createDiscussion(a){let b=new Date,c={...a,createdAt:b,updatedAt:b,replyCount:0,likes:0},[e]=await i.insert(d.discussions).values(c).returning();return e}async updateDiscussion(a,b){let[c]=await i.update(d.discussions).set({...b,updatedAt:new Date}).where((0,j.eq)(d.discussions.id,a)).returning();return c}async deleteDiscussion(a){return(await i.delete(d.discussions).where((0,j.eq)(d.discussions.id,a)).returning({id:d.discussions.id})).length>0}async likeDiscussion(a){let b=await this.getDiscussion(a);if(!b)return!1;let c=(b.likes||0)+1;return!!await this.updateDiscussion(a,{likes:c})}async getMessage(a){let[b]=await i.select().from(d.messages).where((0,j.eq)(d.messages.id,a));return b}async getMessages(a){let b=i.select().from(d.messages);void 0!==a.senderId&&(b=b.where((0,j.eq)(d.messages.senderId,a.senderId))),void 0!==a.recipientId&&(b=b.where((0,j.eq)(d.messages.recipientId,a.recipientId))),void 0!==a.isRead&&(b=b.where((0,j.eq)(d.messages.isRead,a.isRead)));let c=a.page||1,e=a.limit||20;return b=(b=b.limit(e).offset((c-1)*e)).orderBy((0,k.i)(d.messages.createdAt)),await b}async createMessage(a){let b={...a,createdAt:new Date,isRead:!1},[c]=await i.insert(d.messages).values(b).returning();return c}async markMessageAsRead(a){let[b]=await i.update(d.messages).set({isRead:!0}).where((0,j.eq)(d.messages.id,a)).returning();return!!b}async deleteMessage(a){return(await i.delete(d.messages).where((0,j.eq)(d.messages.id,a)).returning({id:d.messages.id})).length>0}async getNotification(a){let[b]=await i.select().from(d.notifications).where((0,j.eq)(d.notifications.id,a));return b}async getNotifications(a,b){let c=i.select().from(d.notifications).where((0,j.eq)(d.notifications.userId,a));return void 0!==b&&(c=c.where((0,j.eq)(d.notifications.isRead,b))),c=c.orderBy((0,k.i)(d.notifications.createdAt)),await c}async createNotification(a){let b={...a,createdAt:new Date,isRead:!1},[c]=await i.insert(d.notifications).values(b).returning();return c}async markNotificationAsRead(a){let[b]=await i.update(d.notifications).set({isRead:!0}).where((0,j.eq)(d.notifications.id,a)).returning();return!!b}async deleteNotification(a){return(await i.delete(d.notifications).where((0,j.eq)(d.notifications.id,a)).returning({id:d.notifications.id})).length>0}async getEducationalContent(a){let[b]=await i.select().from(d.educationalContent).where((0,j.eq)(d.educationalContent.id,a));return b}async getEducationalContents(a){let b=i.select().from(d.educationalContent);if(a){if(a.category&&(b=b.where((0,j.eq)(d.educationalContent.category,a.category))),void 0!==a.authorId&&(b=b.where((0,j.eq)(d.educationalContent.authorId,a.authorId))),void 0!==a.featured&&(b=b.where((0,j.eq)(d.educationalContent.featured,a.featured))),a.search){let c=`%${a.search}%`;b=b.where((0,j.or)((0,j.mj)(d.educationalContent.title,c),(0,j.mj)(d.educationalContent.content,c),(0,j.mj)(d.educationalContent.category,c)))}let c=a.page||1,e=a.limit||10;b=b.limit(e).offset((c-1)*e)}return b=b.orderBy((0,k.i)(d.educationalContent.publishedDate)),await b}async createEducationalContent(a){let b=new Date,c={...a,publishedDate:b,lastUpdated:b},[e]=await i.insert(d.educationalContent).values(c).returning();return e}async updateEducationalContent(a,b){let[c]=await i.update(d.educationalContent).set({...b,lastUpdated:new Date}).where((0,j.eq)(d.educationalContent.id,a)).returning();return c}async deleteEducationalContent(a){return(await i.delete(d.educationalContent).where((0,j.eq)(d.educationalContent.id,a)).returning({id:d.educationalContent.id})).length>0}async getAppointment(a){let[b]=await i.select().from(d.appointments).where((0,j.eq)(d.appointments.id,a));return b}async getAppointments(a){let b=i.select().from(d.appointments);void 0!==a.patientId&&(b=b.where((0,j.eq)(d.appointments.patientId,a.patientId))),void 0!==a.providerId&&(b=b.where((0,j.eq)(d.appointments.providerId,a.providerId))),a.startDate&&(b=b.where((0,j.RO)(d.appointments.startTime,a.startDate))),a.endDate&&(b=b.where((0,j.wJ)(d.appointments.endTime,a.endDate))),a.status&&(b=b.where((0,j.eq)(d.appointments.status,a.status)));let c=a.page||1,e=a.limit||10;return b=(b=b.limit(e).offset((c-1)*e)).orderBy((0,k.Y)(d.appointments.startTime)),await b}async createAppointment(a){let b={...a,reminderSent:!1},[c]=await i.insert(d.appointments).values(b).returning();return c}async updateAppointment(a,b){let[c]=await i.update(d.appointments).set(b).where((0,j.eq)(d.appointments.id,a)).returning();return c}async cancelAppointment(a){let[b]=await i.update(d.appointments).set({status:"cancelled"}).where((0,j.eq)(d.appointments.id,a)).returning();return!!b}async optimizeDatabase(){let a=[],b=0;try{let c=await i.select().from(d.users),e=new Map;for(let a of c)e.has(a.email)||e.set(a.email,[]),e.get(a.email).push(a);for(let[c,f]of e)if(f.length>1){f.sort((a,b)=>a.createdAt.getTime()-b.createdAt.getTime());for(let e=1;e<f.length;e++)await i.delete(d.users).where((0,j.eq)(d.users.id,f[e].id)),b++,a.push(`Removed duplicate user: ${c} (ID: ${f[e].id})`)}return a.push("Completed duplicate user cleanup"),{duplicatesRemoved:b,optimizations:a}}catch(a){return console.error("Database optimization error:",a),{duplicatesRemoved:0,optimizations:["Error during optimization: "+a.message]}}}}let m=new l}};